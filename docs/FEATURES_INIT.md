# AI 亲子基因探测器 - 功能初始化文档 (v1.0)

## 1. 项目概述
基于 Google Gemini 视觉模型的趣味亲子特征分析应用。用户通过输入一次性激活码，上传父母与孩子的照片，AI 自动分析五官遗传特征（眉毛、眼睛、鼻子、嘴巴、脸型等），生成可视化分析报告。

## 2. 核心功能模块

### 🛠 后端 (FastAPI + SQLite)

#### 2.1 激活码系统 (`/api/code`)
*   **批量生成**：管理员可批量生成激活码（`batch-create`），支持自定义数量。
    *   *安全*：接口由 HTTP Basic Auth 保护。
*   **验证机制**：
    *   **一码一机**：激活码首次使用绑定设备（FingerprintJS），防止多设备共享。
    *   **一次性消费**：激活码一旦生成结果，即视为“已消费”。
    *   **防回溯**：已出结果的激活码禁止再次进入上传流程，禁止再次查看（阅后即焚）。
    *   **测试通道**：保留 `TEST8888` 等特殊测试码，支持无限次重置与跨设备测试。
*   **路由守卫 (`/check-status`)**：提供实时状态检查，供前端路由拦截非法访问。

#### 2.2 AI 分析服务 (`/api/analyze`)
*   **多图处理**：支持父/母/子多张图片上传。
*   **隐私处理**：图片在内存中处理，分析完成后立即释放，仅保留必要缓存（24小时自动清理）。
*   **Gemini 集成**：调用 `gemini-1.5-flash` 或 `pro` 模型进行 106 点面部特征识别与遗传相似度计算。
*   **防重复分析**：后端强制锁，如果当前激活码已有结果，拒绝二次分析请求。

#### 2.3 系统调度 (`Scheduler`)
*   **自动清理**：每小时执行任务，物理删除超过 24 小时的激活码记录及临时文件。

### 💻 前端 (React + Vite)

#### 2.4 用户交互流程
1.  **首页 (`Home`)**：
    *   输入激活码激活。
    *   强制“用户协议”勾选验证。
    *   集成 FingerprintJS 获取设备指纹。
2.  **上传页 (`Upload`)**：
    *   父亲/母亲/孩子照片上传（孩子必填）。
    *   图片本地预览与移除。
    *   支持断点恢复（只要没出结果，可重新进入上传）。
3.  **分析页 (`Analyze`)**：
    *   炫酷的雷达扫描与进度条动画。
    *   实时状态反馈。
    *   **智能防误触**：如果分析中途按返回键，自动识别状态并跳转结果页。
4.  **结果页 (`Result`)**：
    *   **Canvas 渲染**：动态生成遗传分析连线图。
    *   **阅后即焚**：明确提示页面关闭即销毁。
    *   **安全获取**：强制从后端拉取结果，不依赖本地缓存，杜绝“串号”。
    *   **保存功能**：支持将分析结果保存为图片。

## 3. 安全与隐私特性

*   **数据隔离**：严格基于 Bearer Token (激活码) 获取数据，杜绝越权访问。
*   **阅后即焚**：前端页面关闭后无法找回；后端拒绝已消费码的二次访问。
*   **反爬虫/防爆破**：内存级 Rate Limiting (限流)，限制激活码验证频率。
*   **文档保护**：Swagger UI/Redoc 文档默认隐藏，需管理员账号密码访问。

## 4. 部署与配置

*   **环境变量**：支持 `.env` 配置 API Key、管理员账号等敏感信息。
*   **数据持久化**：使用 SQLite (`app.db`)，轻量级且易于备份/重置。

---
*文档生成时间：2026-01-15*
