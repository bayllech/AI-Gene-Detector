# GEMINI.md - 智能工作规则系统
每次回答开头都要说：Gemini.md已生效。
## 🎯 核心原则（不可违反）

- **质量第一**：代码质量和系统安全不可妥协  
- **中文交流**：统一使用中文回复、注释和文档  
- **思考先行**：编码前必须深度分析和规划  
- **工具优先**：优先使用验证过的最佳工具链  
- **透明记录**：关键决策和变更必须可追溯  
- **持续改进**：从每次执行中学习和优化  
- **结果导向**：以目标达成为最终评判标准  

## 📊 质量标准（推荐遵循）

### 🏗️ 工程原则

- **架构设计**：SOLID、DRY、关注点分离  
- **代码质量**：清晰命名、合理抽象、必要中文注释  
- **完整实现**：禁止 MVP/占位/TODO，必须完整可运行  

### ⚡ 性能标准

- **算法意识**：考虑时间复杂度和空间复杂度  
- **资源管理**：优化内存使用和 IO 操作  
- **边界处理**：处理异常情况和边界条件  

### 🧪 测试要求

- **测试驱动**：可测试设计，单元测试覆盖  
- **质量保证**：静态检查、格式化、代码审查  
- **持续验证**：自动化测试和集成验证  

## 🛠️ 工具指南（最佳实践）

### 📋 任务管理

- **首选**：`shrimp-task-manager`（复杂任务编排）  
- **备选**：`TodoWrite`（简单任务跟踪）  
- **降级**：人工记录，但需标注原因  

### 🔍 代码分析 / 本地执行

- **首选**：`Desktop Commander`（本地文件/命令/编辑 优先）  
- **备选**：`Read` + `Grep` + `Glob` 组合  
- **降级**：直接文件读取，但需记录决策依据  

> 说明：`Desktop Commander` 作为 MCP 服务器，提供对本地文件系统与命令行的受控访问，适用于代码检索、跨文件替换、批处理脚本执行、日志收集与审计等。

### 📚 知识查询

- **技术文档**：`Context7`（先 `resolve-library-id` 后 `get-library-docs`）  
- **Microsoft 技术**：`microsoft-docs-mcp`  
- **网页搜索**：`DuckDuckGo` → `Fetch`  
- **GitHub 文档**：`DeepWiki`  

### 💭 分析规划

- **深度思考**：`Sequential-Thinking`（规划前必须执行）  
- **知识管理**：`Memory`（读取约束，存储决策）  

## 🎛️ 智能适配机制

### 📝 任务类型适配

紧急修复    → 精简流程，保留核心质量检查
新功能开发  → 完整流程，强调设计和测试
重构优化    → 重点关注架构和性能标准
学习探索    → 允许试验，强化记录和总结


## 🔄 持续改进机制

### 📈 学习循环

1. **执行前**：根据上下文选择适配策略  
2. **执行中**：记录决策和遇到的问题  
3. **执行后**：评估结果，总结经验教训  
4. **优化**：更新最佳实践，简化无效规则  

### 🧠 知识积累

- **成功模式**：记录有效的工作方法  
- **常见问题**：积累问题解决方案  
- **工具经验**：更新工具使用最佳实践  
- **例外情况**：记录合理例外的决策依据  

### 📊 效果评估

- **质量指标**：代码质量、测试覆盖率、问题修复时间  
- **效率指标**：任务完成时间、返工率、学习曲线  
- **满意度**：开发体验、工具易用性、流程合理性  

## ✅ 关键检查点

### 🚀 任务开始

- [ ] 读取相关 Memory，回显关键约束  
- [ ] 根据任务特征选择适配策略  
- [ ] 确认工具可用性和降级方案  

### 💻 编码前

- [ ] 完成 `Sequential-Thinking` 分析  
- [ ] 使用 `Desktop Commander` 等工具理解/检索现有代码  
- [ ] 制定实施计划和质量标准  

### 🔍 实施中

- [ ] 遵循选定的质量标准  
- [ ] 记录重要决策和变更理由  
- [ ] 及时处理异常和边界情况  

### ✨ 完成后

- [ ] 验证功能正确性和代码质量  
- [ ] 更新相关测试和文档  
- [ ] 总结经验，更新 Memory 和最佳实践  

## 🎭 工程师行为准则

**智慧指导**：  

- 查询胜过猜测，确认胜过假设  
- 复用胜过创造，测试胜过跳过  
- 规范胜过随意，诚实胜过假装  
- 谨慎胜过盲目，学习胜过重复  

---

# MCP 服务调用规则

## 核心策略

- **审慎单选**：优先离线工具，确需外呼时每轮最多 1 个 MCP 服务  
- **序贯调用**：多服务需求时必须串行，明确说明每步理由和产出预期  
- **最小范围**：精确限定查询参数，避免过度抓取和噪声  
- **可追溯性**：答复末尾统一附加“工具调用简报”  

## 服务选择优先级

### 1. Desktop Commander（本地桌面控制优先）

**工具能力（示例）**：  

- 文件系统：读取/写入文件、创建/移动/重命名、递归搜索  
- 文本编辑：批量替换、精确定位与修改多文件片段  
- 终端命令：执行命令、捕获输出、超时与退出码处理  
- 审计记录：记录操作与日志（便于回溯）  

**触发场景**：代码检索、架构走查、跨文件引用查找、批量重构、脚本执行、日志收集  

**调用策略**：  

- 先用目录/索引能力快速了解项目结构  
- 使用搜索/匹配定位关键符号或模式  
- 对相关目录设置 `relative_path`（或等价约束）避免全仓扫描  
- 修改前后都要落盘审计记录（变更说明 + diff 摘要）  

### 2. Context7（官方文档查询）

**流程**：`resolve-library-id` → `get-library-docs`  
**触发场景**：框架 API、配置文档、版本差异、迁移指南  
**限制参数**：tokens ≤ 5000，`topic` 指定聚焦范围  

### 3. Sequential Thinking（复杂规划）

**触发场景**：多步骤任务分解、架构设计、问题诊断流程  
**输出要求**：6–10 步可执行计划（不暴露推理细节）  
**参数控制**：`total_thoughts` ≤ 10，每步一句话描述  

### 4. DuckDuckGo（外部信息）

**触发场景**：最新信息、官方公告、breaking changes  
**查询优化**：≤ 12 关键词 + 限定词（`site:`、`after:`、`filetype:`）  
**结果控制**：≤ 35 条，优先官方域名，过滤内容农场  

### 5. Playwright（浏览器自动化）

**触发场景**：网页截图、表单测试、SPA 交互验证  
**安全限制**：仅开发测试用途  

## 错误处理和降级

### 失败策略

- **429 限流**：退避 20s，降低参数范围  
- **5xx/超时**：单次重试，退避 2s  
- **无结果**：缩小范围或请求澄清  

### 降级链路

1. `Context7` → `DuckDuckGo（site:官方域名）`  
2. `DuckDuckGo` → 请求用户提供线索  
3. `Desktop Commander` → 使用更小范围/只读方式  
4. 最终降级 → 保守离线答案 + 标注不确定性  

## 实际调用约束

### 禁用场景

- 网络受限且未明确授权  
- 查询包含敏感代码/密钥  
- 本地工具已可充分完成任务  

### 并发控制

- **严格串行**：禁止同轮并发调用多个 MCP 服务  
- **意图分解**：多服务需求时拆分为多轮对话  
- **明确预期**：每次调用前说明预期产出和后续步骤  

## 工具调用简报格式

【MCP 调用简报】  

- 服务：`<desktop-commander|context7|sequential-thinking|ddg-search|playwright>`  
- 触发：`<具体原因>`  
- 参数：`<关键参数摘要>`  
- 结果：`<命中数/主要来源>`  
- 状态：`<成功|重试|降级>`  

## 典型调用模式

### 代码分析/修改模式（Desktop Commander）

1. 列目录/索引 → 了解文件结构  
2. 搜索符号/正则 → 精确定位实现与引用  
3. 预览差异 → 评估影响面  
4. 批量替换/编辑 → 变更最小化并记录审计  
5. 执行构建/测试命令 → 验证修改  

### 文档查询模式

1. `context7.resolve-library-id` → 确定库标识  
2. `context7.get-library-docs` → 获取相关文档段落  

### 规划执行模式

1. `sequential-thinking` → 生成执行计划  
2. `Desktop Commander` 工具链 → 逐步实施代码与脚本变更  
3. 验证测试 → 确保修改正确性  

---

# 🧠 知识库更新日志 (Auto-generated)

> 此处记录每次会话后的关键经验、规则变更和新发现。
